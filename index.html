<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Therapeutic Guidelines: Oral and Dental (Version 4) Assistant</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "SF Pro Text",
        -apple-system, sans-serif;
    }

    body {
      min-height: 100vh;
      background: radial-gradient(circle at top, #e5ebff 0, #eef2ff 40%, #f5f5f7 100%);
      padding: 24px;
      color: #111827;
      display: flex;
      justify-content: center;
      align-items: stretch;
    }

    .shell {
      width: 100%;
      max-width: 1200px;
      background: #f9fafb;
      border-radius: 20px;
      box-shadow: 0 18px 45px rgba(15, 23, 42, 0.18);
      border: 1px solid rgba(148, 163, 184, 0.35);
      display: flex;
      flex-direction: column;
      overflow: hidden;
    }

    /* Top header --------------------------------------------------------- */
    .top-bar {
      padding: 16px 20px;
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(135deg, #f9fafb, #eef2ff);
      border-bottom: 1px solid rgba(148, 163, 184, 0.4);
    }

    .title-row {
      display: flex;
      align-items: center;
      gap: 12px;
    }

    .logo-pill {
      width: 34px;
      height: 34px;
      border-radius: 999px;
      display: flex;
      align-items: center;
      justify-content: center;
      background: linear-gradient(145deg, #2563eb, #1d4ed8);
      color: white;
      font-weight: 700;
      font-size: 16px;
      box-shadow: 0 6px 16px rgba(37, 99, 235, 0.4);
    }

    .title-block {
      display: flex;
      flex-direction: column;
      gap: 2px;
    }

    .app-title {
      font-size: 17px;
      font-weight: 600;
      color: #111827;
    }

    .app-subtitle {
      font-size: 12px;
      color: #6b7280;
    }

    .status-pill {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 999px;
      background: #ecfdf3;
      border: 1px solid #bbf7d0;
      font-size: 11px;
      color: #166534;
      font-weight: 500;
      white-space: nowrap;
    }

    .status-dot {
      width: 8px;
      height: 8px;
      border-radius: 999px;
      background: #22c55e;
      box-shadow: 0 0 0 3px rgba(34, 197, 94, 0.35);
    }

    /* Layout: sidebar + main -------------------------------------------- */
    .layout {
      display: grid;
      grid-template-columns: minmax(260px, 320px) minmax(0, 1fr);
      border-top: 1px solid rgba(148, 163, 184, 0.35);
      height: 600px;
      background: #f9fafb;
    }

    @media (max-width: 900px) {
      body {
        padding: 12px;
      }
      .shell {
        border-radius: 16px;
      }
      .layout {
        grid-template-columns: 1fr;
        height: auto;
      }
    }

    /* Sidebar ----------------------------------------------------------- */
    .sidebar {
      padding: 16px 18px 18px 18px;
      border-right: 1px solid rgba(148, 163, 184, 0.2);
      background: #f9fafb;
    }

    .section-label {
      font-size: 11px;
      font-weight: 600;
      letter-spacing: 0.06em;
      color: #6b7280;
      margin-bottom: 6px;
    }

    .how-card {
      background: white;
      border-radius: 12px;
      border: 1px solid rgba(148, 163, 184, 0.4);
      padding: 12px 12px 10px 12px;
      box-shadow: 0 6px 15px rgba(15, 23, 42, 0.06);
      font-size: 12px;
      line-height: 1.5;
      color: #374151;
      margin-bottom: 12px;
    }

    .how-card em {
      font-style: normal;
      font-weight: 500;
      color: #111827;
    }

    .chips-row {
      display: flex;
      flex-direction: column;
      gap: 8px;
      margin-bottom: 12px;
    }

    .chip-label {
      font-size: 11px;
      font-weight: 600;
      color: #6b7280;
      letter-spacing: 0.06em;
      margin-bottom: 2px;
    }

    .chip {
      background: #eff6ff;
      border-radius: 999px;
      padding: 6px 10px;
      font-size: 11px;
      color: #1d4ed8;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      border: 1px solid rgba(129, 140, 248, 0.6);
      cursor: default;
      white-space: nowrap;
    }

    .chip span.code {
      font-size: 10px;
      font-weight: 600;
      text-transform: uppercase;
      color: #6b7280;
    }

    .behaviour {
      font-size: 11px;
      color: #6b7280;
      line-height: 1.5;
    }

    .behaviour li {
      margin-left: 14px;
      margin-bottom: 4px;
    }

    .important-line {
      font-size: 11px;
      color: #6b7280;
      margin-top: 12px;
    }

    .important-line span {
      font-weight: 600;
      color: #4b5563;
    }

    /* Main chat area ---------------------------------------------------- */
    .main {
      padding: 16px 16px 0 16px;
      display: flex;
      flex-direction: column;
      background: radial-gradient(circle at top, #ffffff 0, #f9fafb 55%);
    }

    .chat-card {
      flex: 1;
      background: #ffffff;
      border-radius: 18px;
      border: 1px solid rgba(148, 163, 184, 0.35);
      box-shadow: 0 12px 28px rgba(15, 23, 42, 0.06);
      overflow: hidden;
      display: flex;
      flex-direction: column;
    }

    .chat-header {
      padding: 12px 18px;
      border-bottom: 1px solid rgba(229, 231, 235, 0.9);
      display: flex;
      align-items: center;
      justify-content: space-between;
      background: linear-gradient(180deg, #f9fafb, #ffffff);
    }

    .chat-header-left {
      display: flex;
      align-items: center;
      gap: 8px;
      font-size: 13px;
      color: #374151;
    }

    .chat-header-tag {
      font-size: 11px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #eef2ff;
      color: #4f46e5;
      border: 1px solid rgba(129, 140, 248, 0.55);
    }

    .chat-logo-small {
      width: 22px;
      height: 22px;
      border-radius: 999px;
      background: linear-gradient(145deg, #2563eb, #1d4ed8);
      color: white;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 11px;
      font-weight: 600;
    }

    .chat-scroll {
      flex: 1;
      padding: 18px 22px 16px 22px;
      overflow-y: auto;
    }

    .message {
      margin-bottom: 12px;
      max-width: 100%;
      font-size: 14px;
      line-height: 1.5;
      white-space: pre-wrap;
    }

    .message.user {
      margin-left: auto;
      background: #2563eb;
      color: #ffffff;
      border-radius: 14px;
      padding: 10px 12px;
      max-width: 70%;
      border-bottom-right-radius: 4px;
    }

    .message.bot {
      margin-right: auto;
      background: #f9fafb;
      color: #111827;
      border-radius: 14px;
      padding: 10px 12px;
      max-width: 80%;
      border-bottom-left-radius: 4px;
      border: 1px solid rgba(229, 231, 235, 0.9);
    }

    /* INTRO message special styling ------------------------------------ */
    .message.bot.intro {
      background: #ffffff;
      border: none;
      padding: 28px 40px;
      margin: 0 auto;
      max-width: 900px;
      text-align: left;
      line-height: 1.55;
      color: #111827;
      box-shadow: none;
    }

    .intro p {
      margin: 0 0 16px 0;
    }

    .intro ul {
      margin: 0 0 16px 20px;
      padding: 0;
    }

    .intro li {
      margin-bottom: 8px;
    }

    .meta {
      font-size: 11px;
      color: #6b7280;
      margin-top: 4px;
    }

    .input-shell {
      padding: 10px 18px 14px 18px;
      border-top: 1px solid rgba(229, 231, 235, 0.9);
      background: #f9fafb;
      display: flex;
      flex-direction: column;
      gap: 8px;
    }

    .input-row {
      display: flex;
      align-items: center;
      gap: 10px;
      background: #ffffff;
      border-radius: 999px;
      border: 1px solid rgba(209, 213, 219, 0.9);
      padding-left: 16px;
      padding-right: 6px;
      box-shadow: 0 4px 14px rgba(148, 163, 184, 0.35);
    }

    textarea {
      flex: 1;
      border: none;
      outline: none;
      resize: none;
      padding: 10px 0;
      font-size: 13px;
      color: #111827;
      background: transparent;
      max-height: 120px;
    }

    textarea::placeholder {
      color: #9ca3af;
    }

    button {
      border: none;
      outline: none;
      background: #2563eb;
      color: white;
      padding: 9px 18px;
      border-radius: 999px;
      font-size: 13px;
      font-weight: 500;
      cursor: pointer;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      white-space: nowrap;
    }

    button:disabled {
      opacity: 0.6;
      cursor: default;
    }

    .spinner {
      width: 14px;
      height: 14px;
      border-radius: 999px;
      border: 2px solid rgba(148, 163, 184, 0.6);
      border-top-color: white;
      animation: spin 0.7s linear infinite;
    }

    @keyframes spin {
      to {
        transform: rotate(360deg);
      }
    }

    .input-footer {
      display: flex;
      justify-content: space-between;
      font-size: 11px;
      color: #9ca3af;
      padding: 0 2px;
    }

    .input-footer span.code {
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas,
        "Liberation Mono", "Courier New", monospace;
    }
  </style>
</head>
<body>
  <div class="shell">
    <!-- Top header -->
    <div class="top-bar">
      <div class="title-row">
        <div class="logo-pill">TG</div>
        <div class="title-block">
          <div class="app-title">
            Therapeutic Guidelines: Oral and Dental (Version 4) Assistant
          </div>
          <div class="app-subtitle">
            Answers constrained to your copy of Therapeutic Guidelines: Oral and Dental, Version 4 (2025 update).
          </div>
        </div>
      </div>
      <div class="status-pill">
        <div class="status-dot"></div>
        Connected to guidelines backend
      </div>
    </div>

    <!-- Main layout -->
    <div class="layout">
      <!-- Sidebar -->
      <aside class="sidebar">
        <div class="section-label">HOW TO ASK</div>
        <div class="how-card">
          Formulate questions the way you would in clinic, but anchor them to the
          guideline topic. For example, include terms such as
          <em>postoperative pain</em>, <em>acute odontogenic infection</em>, or
          <em>infective endocarditis prophylaxis</em>.
        </div>

        <div class="chips-row">
          <div class="chip-label">SUGGESTIONS</div>
          <div class="chip">
            <span class="code">EXAMPLE</span>
            First-line analgesia for uncomplicated postoperative pain
          </div>
          <div class="chip">
            <span class="code">EXAMPLE</span>
            When to avoid or use caution with ibuprofen
          </div>
          <div class="chip">
            <span class="code">EXAMPLE</span>
            Antibiotic regimen for acute odontogenic infection
          </div>
        </div>

        <div class="section-label">BEHAVIOUR</div>
        <ul class="behaviour">
          <li>
            The assistant will only draw on your loaded Oral and Dental guidelines PDF.
          </li>
          <li>
            If the answer is not clearly present, it will say so rather than infer.
          </li>
          <li>
            Responses support guideline navigation and do not replace clinical judgement.
          </li>
        </ul>

        <p class="important-line">
          <span>Important:</span> Always apply your own clinical judgement, local protocols and regulatory requirements.
        </p>
      </aside>

      <!-- Main chat panel -->
      <main class="main">
        <div class="chat-card">
          <div class="chat-header">
            <div class="chat-header-left">
              <div class="chat-logo-small">TG</div>
              <span>Welcome.</span>
            </div>
            <div class="chat-header-tag">Guidelines-constrained answers</div>
          </div>

          <div id="chat" class="chat-scroll">
            <!-- Introductory bot message -->
            <div class="message bot intro">
              <p><strong>Welcome. ðŸ‘‹</strong></p>

              <p>
                I am an assistant constrained to the content of your copy of
                <strong>Therapeutic Guidelines: Oral and Dental (Version 4, 2025 update)</strong>.
                I will:
              </p>

              <ul>
                <li>Retrieve the most relevant guideline pages for your query</li>
                <li>Answer using only those passages</li>
                <li>Indicate which pages were used</li>
              </ul>

              <p style="font-size: 13px; color: #6b7280;">
                If the guidelines do not clearly address your question, I will state that this
                is not specified rather than inferring or extrapolating.
              </p>
            </div>
          </div>

          <!-- Input area -->
          <div class="input-shell">
            <div class="input-row">
              <textarea
                id="question"
                placeholder="Ask about dosing, indications, cautions, or management as described in the Oral and Dental guidelines..."
              ></textarea>
              <button id="send-btn" onclick="sendQuestion()">
                <span id="btn-label">Send</span>
                <div id="btn-spinner" class="spinner" style="display:none;"></div>
              </button>
            </div>
            <div class="input-footer">
              <span>Press <strong>Enter</strong> to send Â· <strong>Shift+Enter</strong> for a new line</span>
              <span>Backend endpoint: <span class="code">/ask</span></span>
            </div>
          </div>
        </div>
      </main>
    </div>
  </div>

  <script>
    // On Railway the frontend and backend share the same origin,
    // so we can call the FastAPI /ask route with a relative URL.
    const API_URL = "/ask";

    const chatEl = document.getElementById("chat");
    const qEl = document.getElementById("question");
    const sendBtn = document.getElementById("send-btn");
    const btnLabel = document.getElementById("btn-label");
    const btnSpinner = document.getElementById("btn-spinner");

    function appendMessage(content, sender, meta) {
      const msg = document.createElement("div");
      msg.className = `message ${sender}`;
      msg.textContent = content;

      if (meta) {
        const m = document.createElement("div");
        m.className = "meta";
        m.textContent = meta;
        msg.appendChild(m);
      }

      chatEl.appendChild(msg);
      chatEl.scrollTop = chatEl.scrollHeight;
    }

    async function sendQuestion() {
      const text = qEl.value.trim();
      if (!text) return;

      appendMessage(text, "user");
      qEl.value = "";

      sendBtn.disabled = true;
      btnLabel.textContent = "Thinking...";
      btnSpinner.style.display = "inline-block";

      try {
        const res = await fetch(API_URL, {
          method: "POST",
          headers: {
            "Content-Type": "application/json",
          },
          body: JSON.stringify({ question: text }),
        });

        if (!res.ok) {
          const errText = await res.text();
          appendMessage(
            "Sorry, something went wrong talking to the backend.",
            "bot",
            `HTTP ${res.status}: ${errText}`
          );
        } else {
          const data = await res.json();
          const pages =
            data.used_pages && data.used_pages.length
              ? `Based on pages: ${data.used_pages.join(", ")}`
              : "No specific pages identified.";
          appendMessage(data.answer, "bot", pages);
        }
      } catch (err) {
        appendMessage(
          "I couldnâ€™t reach the backend service.",
          "bot",
          String(err)
        );
      } finally {
        sendBtn.disabled = false;
        btnLabel.textContent = "Send";
        btnSpinner.style.display = "none";
      }
    }

    // Enter to send, Shift+Enter for newline
    qEl.addEventListener("keydown", (e) => {
      if (e.key === "Enter" && !e.shiftKey) {
        e.preventDefault();
        sendQuestion();
      }
    });
  </script>
</body>
</html>
